title: 高收益债组合优化和回测
date: 2014-05-25 20:34:47 
author: Weilin Lin
categories:
- 债券货币市场
- 高收益债
---




##  组合优化
### 组合模型设计
我们的目标总结地讲很简单，就是要在最大化组合收益的条件下控制好组合中每个券的风险暴露，我们可以将这个问题描述为一个优化为题，具体的组合构建模型设计如下：
 1.  假设t为我们rebalance的时间点，那么在这天开始的时候，假设我们的组合里面还剩余有$cashBOD_{t}$的现金。
 2.  假设持仓的向量表示为$\overrightarrow{shsHldBOD} = [shsHldBOD\_{1},shsHldBOD\_{2},\.\.\.,shsHldBOD\_{n}]^T$
 3.  我们需要求解的变量是t日的每只券的持仓数量$\overrightarrow{X} = \overrightarrow{shsHldEOD} = [shsHldEOD\_{1},shsHldEOD\_{2},\.\.\.,shsHldEOD\_{n}]^T$

那么调仓日开始的总市值可以表示为:$ntnlHldBOD\_{t} = \sum^{n}\_{i=1} (Price\_{i,t-1} * shsHldBOD\_{it}) + cashBOD\_{t}$，我们组合优化的问题变成了求解以下的最优化问题：

$$
\begin{aligned}
 & \max\_{x\_{1}\ldots x\_{n}}:  \sum^{n}\_{i=1} \frac{x\_{i,t}\times Price\_{i,t-1}}{ntnlHldBOD\_{t}}\times YTM\_{i,t-1} \\
 \newline & St: 
 \newline & 0\leq x\_{i}\times Price\_{i,t-1} \leq 5\%\times ntnlHldBOD\_{t}, i = 1\ldots n \\
 \newline & shsHldBOD\_{it} - \theta \times atv\_{i,t-1} \leq x\_{it} \leq shsHldBOD\_{it}+\theta\times atv\_{i,t-1}, i = 1\ldots n\\
 \newline & \sum^{n}\_{i=1} \frac{x\_{i,t}\times Price\_{i,t-1}}{ntnlHldBOD\_{t}} \leq 1
 \newline & \sum^{n}\_{i=1} x\_{i,t} \times atv\_{i,t-1} \geq n \times 500000
\end{aligned}
$$

接下来我们要考虑的是对构建参数的组合进行优化，我们回测的参数配置情况如下所示：


```r
startDate <- 20130101
endDate <- 20140519
cfgLst <- list(region = "CN", runFromScratch = TRUE, hldFile = "~/hld_20140514.csv", 
    startDate = startDate, endDate = endDate, tradeLot = 10, extraTC = 1/10000, 
    volumeParticipationLimit = 0.1, individualHldLimit = 0.02, portsz = 5 * 
        1e+08, tradeThreshold = 0.08, tradeOutThreshold = 0.06, atvThreshold = 50 * 
        10000, atvOutThreshold = 0.8 * 50 * 10000, useGradeFilter = F, dataOutDir = "~/temp/backtestETF/exchangeHY", 
    rebalanceFreq = "monthly", strategyName = "交易所高收益债策略")
```



我们这里有几个关键的参数需要优化，具体的含义如下：

1. tradeThreshold = 0.08,            表示当债券的收益率高于8%我们就令程序在二级市场买入
2. tradeOutThreshold = 0.06，        表示当债券的收益率低于6%我们就令程序在二级市场卖出
3. atvThreshold = 50 * 1e4，         表示当债券的流动性指标满足该阀值的时候我们才在二级市场买入
4. atvOutThreshold = 0.8 \* 50 \* 1e4, 表示当债券的流动性指标不满足该阀值的时候我们就在二级市场卖出
5. individualHldLimit = 0.02,        表示个券占组合净值的最大比例，该值设置得越小则组合持有的高收益债的数量越多




```r
backtest.optimize.test <- function() {
    Sys.setenv(TEST = "yes")
    source("/home/amg/svn/yieldCurve/profiling/Rprofile.R")
    setwd("/home/amg/svn/assetAllocation/dev/backtest/R")
    source("exchangeHY.R")
    library(lpSolve)
    library(Rsolnp)
    parmDf <- expand.grid(tradeThreshold = c(0.1, 0.09, 0.08, 0.07), tradeOutThreshold = c(0.08, 
        0.07, 0.06, 0.05), atvThreshold = c(100 * 10000, 50 * 10000, 30 * 10000), 
        atvOutThreshold = c(0.8 * 100 * 10000, 0.8 * 50 * 10000, 0.8 * 30 * 
            10000), individualHldLimit = c(0.1, 0.05, 0.02))
    
    startDate <- 20130101
    endDate <- 20140522
    cfgLst <- list(region = "CN", runFromScratch = TRUE, loadData = FALSE, hldFile = "~/hld_20140514.csv", 
        startDate = startDate, endDate = endDate, tradeLot = 10, extraTC = 1/10000, 
        volumeParticipationLimit = 0.1, individualHldLimit = 0.02, portsz = 50 * 
            10000, tradeThreshold = 0.08, tradeOutThreshold = 0.06, atvThreshold = 50 * 
            10000, atvOutThreshold = 0.8 * 50 * 10000, useGradeFilter = F, dataOutDir = "~/temp/backtestETF/exchangeHY", 
        rebalanceFreq = "monthly", strategyName = "交易所高收益债策略")
    
    cfgLst <- backtest.loadData(cfgLst)
    optimizeLst <- list()
    for (i in 1:nrow(parmDf)) {
        cfgLst$tradeThreshold <- parmDf$tradeThreshold[i]
        cfgLst$tradeOutThreshold <- parmDf$tradeOutThreshold[i]
        cfgLst$atvThreshold <- parmDf$atvThreshold[i]
        cfgLst$atvOutThreshold <- parmDf$atvOutThreshold[i]
        cfgLst$individualHldLimit <- parmDf$individualHldLimit[i]
        cfgLst <- backtest(cfgLst)
        lst <- backtest.summary(cfgLst, ifPlot = FALSE)
        optimizeLst[[i]] <- lst$ALL
        optimizeDf <- df.rbindList(optimizeLst)
        saveDf <- cbind(parmDf[1:i, ], optimizeDf)
        ## Write to local dir
        write.csv(saveDf, file = "/home/amg/data/assetAllocation/cn/exchangeHY/backtest/exchangeHY_backtest_parmDf.csv", 
            row.names = FALSE)
    }
}
```



首先是对进出收益率的阀值进行分析，无论是从累计收益率还是从回测计算的夏普比例看，在过去一年多的时间里面，设置tradeThreshold（即收益率高于该值的时候就杀进去）的值为10%是最好的的，退出的时候设置tradeOutThreshold为7%是最好的选择，因此我们在未来模拟组合的操作中就把这两个参数定在10%和7%。


```r
df <- read.csv("/home/amg/data/assetAllocation/cn/exchangeHY/backtest/exchangeHY_backtest_parmDf.csv")
df <- df[(df$tradeThreshold >= df$tradeOutThreshold) & (df$atvThreshold >= df$atvOutThreshold), 
    ]
aggregate(ret.P ~ tradeThreshold, data = df, FUN = mean)
```

```
##   tradeThreshold  ret.P
## 1           0.07  9.975
## 2           0.08  7.744
## 3           0.09  9.079
## 4           0.10 10.977
```

```r
aggregate(ret.P ~ tradeOutThreshold, data = df, FUN = mean)
```

```
##   tradeOutThreshold ret.P
## 1              0.05 9.442
## 2              0.06 9.460
## 3              0.07 9.506
## 4              0.08 9.164
```

```r
aggregate(SR ~ tradeThreshold, data = df, FUN = mean)
```

```
##   tradeThreshold    SR
## 1           0.07 1.228
## 2           0.08 1.027
## 3           0.09 1.226
## 4           0.10 1.563
```

```r
aggregate(SR ~ tradeOutThreshold, data = df, FUN = mean)
```

```
##   tradeOutThreshold    SR
## 1              0.05 1.257
## 2              0.06 1.261
## 3              0.07 1.273
## 4              0.08 1.262
```


另外两个关于流动性德参数，我们也进行了同样的分析，得出的最优结果是设置当流动性好于100万/天的时候进去，当小于80万/天的时候选择卖出。


```r
aggregate(ret.P ~ atvThreshold, data = df, FUN = mean)
```

```
##   atvThreshold ret.P
## 1        3e+05 9.304
## 2        5e+05 9.391
## 3        1e+06 9.455
```

```r
aggregate(ret.P ~ atvOutThreshold, data = df, FUN = mean)
```

```
##   atvOutThreshold ret.P
## 1          240000 9.288
## 2          400000 9.410
## 3          800000 9.767
```

```r
aggregate(SR ~ atvThreshold, data = df, FUN = mean)
```

```
##   atvThreshold    SR
## 1        3e+05 1.234
## 2        5e+05 1.251
## 3        1e+06 1.281
```

```r
aggregate(SR ~ atvOutThreshold, data = df, FUN = mean)
```

```
##   atvOutThreshold    SR
## 1          240000 1.243
## 2          400000 1.260
## 3          800000 1.330
```



最后最为关键的一个参数是设置每个券的占比情况参数和回测表现的关系，综合收益率和夏普比例的指标可以看出设置该值为2%时表现最佳。


```r
aggregate(ret.P ~ individualHldLimit, data = df, FUN = mean)
```

```
##   individualHldLimit  ret.P
## 1               0.02  9.145
## 2               0.05  8.107
## 3               0.10 10.973
```

```r
aggregate(SR ~ individualHldLimit, data = df, FUN = mean)
```

```
##   individualHldLimit    SR
## 1               0.02 1.677
## 2               0.05 1.039
## 3               0.10 1.074
```



综合上面的分析，我们在实际模拟组合的运营中，选择以下最优参数进行高收益债券的买入和卖出操作：

1. tradeThreshold = 0.1,             当债券的收益率高于10%我们就令程序在二级市场买入。
2. tradeOutThreshold = 0.07，        当债券的收益率低于7%我们就令程序在二级市场卖出。
3. atvThreshold = 100 * 1e4，        当债券的流动性指标满足该阀值的时候我们才在二级市场买入。
4. atvOutThreshold = 80 * 1e4,       当债券的流动性指标小于80万德时候我们就在二级市场卖出。
5. individualHldLimit = 0.02,        个券占组合净值的最大比例设置不能超过2%。

我们就选用改组参数，回测了去年以来的高收益债策略，表现的总结图如下面所示：




**图 1：最优参数表现结果 ** 
* ------------------------------------- *
![高收益债策略](/images/回测最优参数结果.png)
* ------------------------------------- *
资料来源：Wind,COS Inv系统












