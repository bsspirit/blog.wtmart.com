title: 国债期货高频交易策略
date: 2013-10-28 09:27:55
author: Weilin Lin
categories:
- 国债期货和利率
---

## 指标体系构建

目前指标系统主要是包括两方面，一部分是日内的高频技术性指标，另外一部分是日间的宏观经济指标。根据上市一个月来的情况，对不同的技术指标进行回测和选取：

![国债期货高频交易](/uploads/2013/10/国债期货高频交易.png)

##	IRR 指标回测

IRR衡量的是国债期货和现货之间的价格关系，等于买入现货持有到期用于期货交割所获得的收益率。理论上来说的话，如果是有很多套利者参与到这个市场的话，那么IRR的值会接近于货币市场的无风险收益率。 如果IRR过高的话，那么就证明国债期货价格相对于国债现货货价格偏高；反之若IRR过低的话，反之就证明国债期货价格偏低。如果国债期货市场出现不理性的过度上涨或过度下跌的情况话，那么就会在IRR这个指标上面反应出来。我们结合上市两个多月以来的数据，对IRR指标在高频数据上面进行回测看看是否有效。对于每笔成交数据，算出IRR之后，我们按照下面的公式进行正态化处理：

$$ IRR\_{sig}(t) =\frac{IRR\_t-\overline{IRR}}{\frac{1}{n}\sqrt{\sum{i=1}^{n}(IRR{t-i}-\overline{IRR})^2}}, \overline{IRR}=\frac{1}{n}\sum{i=1}^{n}IRR_{t-i}$$

当然正态化处理的一个前提是IRR的分布在短期内应该是正态的或者接近于正太分布的，为此，我们下面会简单检测一下IRR高频数据的分布情况。 现在国债期货的成交量并不是很活跃，平均2到3秒的时间里面会有一笔新的成交。我们以成交的价格序列作为历史数据，分别回测一下n=30,60,90,120的收益情况，回测的代码如下：

首先载入必须的R包

```{r}
library(devtools)
install_github("COSinvestment","casunlight",subdir="quantutils",auth_user="***",password="***")
install_github("COSinvestment","casunlight",subdir="datatools",auth_user="***",password="***")
library(datatools);
utils.init();
```

根据高频数据生成IRR信号

```{r}
library(plyr);
startDate     <- "20130906";
endDate       <- "20131118";
contractJTID  <- "TF1312";
dates         <- date.convert(date.range(startDate, endDate, region = "CN"), format = "YYYYMMDD");    futDf <- mktDataHFT(startDate, endDate, jtids = contractJTID, vars="LastPx");
colnames(futDf)    <- c("contract","date","time","futPrice");
futDf              <- futDf[order(futDf$date, futDf$time), ];
bondMainDf         <- conversionFactor();
bondMainDf         <- subset(bondMainDf, contract == contractJTID);
bondMainDf         <- bondMainDf[,c("contract","IB","CF")];
colnames(bondMainDf) <- c("contract", "jtid", "CF");
dataLst <- list();
for(date in dates){
    cat(date);
    ## calculate IRR on HFT
    # read interbank cash bond valuation data
    mktStatDf <- mktStat.CTDBond(date, contract = contractJTID, region = "CN");
    mktStatDf <- mktStatDf[,c("jtid","date","ValueCleanPrice", "ValueFullPrice","AI0","cashflow","AI1","numOfDays","atv1d")];        IRRDf     <- merge(bondMainDf, mktStatDf, by = "jtid");
    IRRDf     <- subset(IRRDf, !is.na(IRRDf$atv1d));
    dataDf    <- merge(IRRDf, futDf, by = c("contract", "date"));        dataDf$BasisBeforeExpiration <- dataDf$ValueCleanPrice - dataDf$futPrice * dataDf$CF;
    dataDf$IRR <- ((0-dataDf$BasisBeforeExpiration)+(dataDf$AI1-dataDf$AI0)+dataDf$cashflow)/(dataDf$ValueFullPrice)*365/dataDf$numOfDays*100;
    # find the CTD bond.
    dataDf    <- dataDf[with(dataDf, order(time, desc(IRR))),];
    dataDf    <- dataDf[!duplicated(dataDf$time), ];
    #  Calculate the signals.
    dataDf$IRR.30 <- (dataDf$IRR - rollapply(data=dataDf$IRR, width = 30, FUN = mean, fill = NA, align = "right"))/rollapply(data=dataDf$IRR, width = 30, FUN = sd, fill = NA, align = "right");
    dataDf$IRR.60 <- (dataDf$IRR - rollapply(data=dataDf$IRR, width = 60, FUN = mean, fill = NA, align = "right"))/rollapply(data=dataDf$IRR, width = 60, FUN = sd, fill = NA, align = "right");
    dataDf$IRR.90 <- (dataDf$IRR - rollapply(data=dataDf$IRR, width = 90, FUN = mean, fill = NA, align = "right"))/rollapply(data=dataDf$IRR, width = 90, FUN = sd, fill = NA, align = "right");
    dataDf$IRR.120 <- (dataDf$IRR - rollapply(data=dataDf$IRR, width = 120, FUN = mean, fill = NA, align = "right"))/rollapply(data=dataDf$IRR, width = 120, FUN = sd, fill = NA, align = "right");
    # lag signals.
    tmpDf <- zoo(dataDf[,c("IRR.30","IRR.60","IRR.90","IRR.120")]);
    dataDf[,c("IRR.30","IRR.60","IRR.90","IRR.120")] <- lag(tmpDf, -1, na.pad = TRUE);
    dataLst[[date]] <- dataDf[,c("contract","date","time","IRR.30","IRR.60","IRR.90","IRR.120")];
    cat("\b\b\b\b\b\b\b\b");
}
sigDf <- df.rbindList(dataLst);
## Clear the position at the end of day.
    sigDf[is.na(sigDf)] <- 0;
    n     <- nrow(sigDf);
    flags <- which(sigDf$date[2:n] != sigDf$date[1:(n-1)]) + 1;
    sigDf[flags,c("IRR.30","IRR.60","IRR.90","IRR.120")] <- 0;
    # signals construction
    sigDf$IRR.30.Sig <- ifelse(sigDf$IRR.30&gt;2,-1, ifelse(sigDf$IRR.30&gt;-2,0,1));
    sigDf$IRR.60.Sig <- ifelse(sigDf$IRR.60&gt;2,-1, ifelse(sigDf$IRR.60&gt;-2,0,1));
    sigDf$IRR.90.Sig <- ifelse(sigDf$IRR.90&gt;2,-1, ifelse(sigDf$IRR.90&gt;-2,0,1));
    sigDf$IRR.120.Sig <- ifelse(sigDf$IRR.120&gt;2,-1, ifelse(sigDf$IRR.120&gt;-2,0,1));
```

对各个信号进行回测并比较结果

```{r}
## backtest
par(mfrow=c(2,2));
## 30*2s = 1min 钟数据回测
cfgLst <- list(signalVar = "IRR.30.Sig",
               startDate = NULL,
               endDate   = NULL,
               sigDf     = sigDf
               );
cfgLst <- backtest.loadData.bondFuture(cfgLst);
cfgLst <- backtest.bondFuture(cfgLst = cfgLst);
lst30  <- backtest.summary.bondFuture(cfgLst = cfgLst);
## 60*2s = 2min 钟数据回测    cfgLst <- list(signalVar = "IRR.60.Sig",
               startDate = NULL,
               endDate   = NULL,
               sigDf     = sigDf
               );
cfgLst <- backtest.loadData.bondFuture(cfgLst);
cfgLst <- backtest.bondFuture(cfgLst = cfgLst);
lst60  <- backtest.summary.bondFuture(cfgLst = cfgLst);

    ## 90*2s = 3min 钟数据回测
cfgLst <- list(signalVar = "IRR.90.Sig",
               startDate = NULL,
               endDate   = NULL,
               sigDf     = sigDf
               );
cfgLst <- backtest.loadData.bondFuture(cfgLst);
cfgLst <- backtest.bondFuture(cfgLst = cfgLst);
lst90  <- backtest.summary.bondFuture(cfgLst = cfgLst);

    ## 120*2s = 4min 钟数据回测
cfgLst <- list(signalVar = "IRR.120.Sig",
               startDate = NULL,
               endDate   = NULL,
               sigDf     = sigDf
               );
cfgLst <- backtest.loadData.bondFuture(cfgLst);
cfgLst <- backtest.bondFuture(cfgLst = cfgLst);
lst120  <- backtest.summary.bondFuture(cfgLst = cfgLst);
## 总结回测结果
rbind(lst30$ALL, lst60$ALL, lst90$ALL, lst120$ALL);
```

![IRR回测](/uploads/2013/10/IRR回测.png)

净值收益率的走势情况如下所示：

![IRR参数优化](/uploads/2013/10/IRR参数优化.gif)

关于上市以来IRR的走势情况如下图所示，可以看到，IRR波动性有所加大，从频率分布图来看的话近似于正态分布。

![IRR参数优化](/uploads/2013/10/IRR参数优化.gif)

从上面分析的各个结果来看的话，以前30个成交价格计算的IRR信号的表现最好，所以在回测监控界面中，我们采用这个信号作为国债期货价格反转的信号之一。
